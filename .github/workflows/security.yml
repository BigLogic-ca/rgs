name: Security

on:
 push:
  branches: [main, develop]
 pull_request:
  branches: [main, develop]
 schedule:
  - cron: "0 0 * * 0" # Weekly on Sunday

concurrency:
 group: ${{ github.workflow }}-${{ github.ref }}
 cancel-in-progress: true

jobs:
 codeql:
  name: CodeQL
  runs-on: ubuntu-latest
  permissions:
   actions: read
   contents: read
   security-events: write

  steps:
   - name: Checkout repository
     uses: actions/checkout@v4

   - name: Initialize CodeQL
     uses: github/codeql-action/init@v3
     with:
      languages: javascript, typescript
      queries: security-extended

   - name: Autobuild
     uses: github/codeql-action/autobuild@v3

   - name: Perform CodeQL Analysis
     uses: github/codeql-action/analyze@v3
     with:
      category: "/language:javascript,typescript"
      upload: true

 dependency-review:
  name: Dependency Review
  runs-on: ubuntu-latest
  permissions:
   contents: read
  steps:
   - name: Checkout Repository
     uses: actions/checkout@v4

   - name: Dependency Review
     uses: actions/dependency-review-action@v4
     with:
      comment-summary-in-pr: always
      fail-on-severity: moderate
      license-allow-list: MIT, Apache-2.0, BSD-2-Clause, BSD-3-Clause, ISC, CC0-1.0
